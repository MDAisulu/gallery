var fs = require('fs');
const PATH = require('path');
const dirTree = require('directory-tree');
// var tree = dirTree('./app');
function MyPlugin() {
}

MyPlugin.prototype.apply = function(compiler) {
  compiler.plugin('emit', function(compilation, callback) {
  	//get the main directory
  	 var filelist = dirTree('./production/photos/', ['.jpg', '.jpeg']);
     // var arr = [filelist];
  	 //creating and writing objects to main JSON file
  	 fs.writeFile('./production/json/photos.json', JSON.stringify(filelist), function(err) {
  	 	 if (err) {
		    return err;
		 }
     console.log('success');
  	 });

  	 //separate files to each JSON files
  	 filelist.children.forEach(function(item) {
  	 	fs.writeFile('./production/json/'+ item.name +'.json', JSON.stringify(item), function(err) {
  	 	 if (err) {
		    return err;
		 }
  	 });
});


  	
  	 callback();
  }.bind(this));
};

module.exports = MyPlugin;